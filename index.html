<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Earcut Visualization</title>
  <!-- Include Earcut from a CDN -->
  <script src="https://cdn.jsdelivr.net/npm/earcut@2.2.2/dist/earcut.min.js"></script>
  <style>
    canvas {
      border: 1px solid #ccc;
      margin-bottom: 10px;
    }
    #controls button {
      margin-right: 5px;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="600" height="400"></canvas>
  <div id="controls">
    <button id="clear">Clear</button>
    <button id="triangulate">Triangulate</button>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    // Store vertices as a flat array: [x0, y0, x1, y1, ...]
    let points = [];

    // Capture clicks on the canvas to define the polygon vertices.
    canvas.addEventListener("click", (e) => {
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      points.push(x, y);
      draw();
    });

    // Function to redraw the canvas: plot points and connect them.
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw vertices as small circles.
      ctx.fillStyle = "black";
      for (let i = 0; i < points.length; i += 2) {
        ctx.beginPath();
        ctx.arc(points[i], points[i + 1], 3, 0, Math.PI * 2);
        ctx.fill();
      }

      // Connect the vertices if there are at least 3 points.
      if (points.length >= 6) {
        ctx.beginPath();
        ctx.moveTo(points[0], points[1]);
        for (let i = 2; i < points.length; i += 2) {
          ctx.lineTo(points[i], points[i + 1]);
        }
        ctx.closePath();
        ctx.strokeStyle = "#999";
        ctx.stroke();
      }
    }

    // Clear the canvas and reset the points.
    document.getElementById("clear").addEventListener("click", () => {
      points = [];
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    });

    // When the "Triangulate" button is clicked, run Earcut and draw the triangles.
    document.getElementById("triangulate").addEventListener("click", () => {
      if (points.length < 6) {
        alert("Please define at least 3 points to form a polygon.");
        return;
      }
      // Earcut returns indices into the points array.
      const triangles = earcut(points);
      
      // Redraw the polygon before overlaying triangles.
      draw();

      // Draw each triangle.
      for (let i = 0; i < triangles.length; i += 3) {
        // Compute the vertex positions for each triangle.
        const idx0 = triangles[i] * 2;
        const idx1 = triangles[i + 1] * 2;
        const idx2 = triangles[i + 2] * 2;

        const p0 = [points[idx0], points[idx0 + 1]];
        const p1 = [points[idx1], points[idx1 + 1]];
        const p2 = [points[idx2], points[idx2 + 1]];

        ctx.beginPath();
        ctx.moveTo(p0[0], p0[1]);
        ctx.lineTo(p1[0], p1[1]);
        ctx.lineTo(p2[0], p2[1]);
        ctx.closePath();
        ctx.strokeStyle = "red";
        ctx.stroke();
      }
    });
  </script>
</body>
</html>
